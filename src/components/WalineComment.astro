---
// Waline Comment Component
// Supports anonymous comments, image uploads, and bilingual interface
// Backend needs to be deployed on Vercel (free)
---

<div class="bg-white rounded-xl shadow-xl p-6 md:p-8">
  <h2
    class="text-2xl md:text-3xl font-bold mb-4 text-gray-800"
    data-en="Comments & Feedback"
    data-zh="è¯„è®ºä¸Žåé¦ˆ"
  >
    Comments & Feedback
  </h2>
  <p
    class="text-gray-600 mb-6"
    data-en="Share your thoughts, upload photos of your creations, or just say hi! âœ¨"
    data-zh="åˆ†äº«ä½ çš„æƒ³æ³•ã€ä¸Šä¼ ä½ çš„ä½œå“ç…§ç‰‡ï¼Œæˆ–è€…åªæ˜¯æ‰“ä¸ªæ‹›å‘¼ï¼âœ¨"
  >
    Share your thoughts, upload photos of your creations, or just say hi! âœ¨
  </p>

  <!-- Waline Comment Container -->
  <div id="waline-container"></div>
</div>

<script>
  import { init } from "@waline/client";
  import "@waline/client/style";

  // Function to initialize Waline
  function initWaline() {
    const container = document.getElementById("waline-container");
    if (!container) return;

    // Get current language
    const savedLang = localStorage.getItem("language") || "en";
    const walineLang = savedLang === "zh" ? "zh-CN" : "en";

    // Initialize Waline
    const walineInstance = init({
      el: "#waline-container",
      serverURL: "https://waline-backend-new.vercel.app",
      lang: walineLang,
      locale: {
        placeholder:
          savedLang === "zh"
            ? "å†™ä¸‹ä½ çš„è¯„è®º... (æ”¯æŒ Markdown å’Œå›¾ç‰‡ä¸Šä¼  ðŸ“¸)"
            : "Write your comment... (Supports Markdown & image upload ðŸ“¸)",
        admin: savedLang === "zh" ? "åšä¸»" : "Admin",
        nick: savedLang === "zh" ? "æ˜µç§°" : "Nickname",
        nickError: savedLang === "zh" ? "è¯·å¡«å†™æ˜µç§°" : "Nickname is required",
        mail: savedLang === "zh" ? "é‚®ç®±" : "Email",
        mailError:
          savedLang === "zh"
            ? "è¯·å¡«å†™æ­£ç¡®çš„é‚®ç®±"
            : "Please enter a valid email",
        link: savedLang === "zh" ? "ç½‘å€" : "Website",
        optional: savedLang === "zh" ? "å¯é€‰" : "Optional",
        sofa:
          savedLang === "zh"
            ? "å¿«æ¥åšç¬¬ä¸€ä¸ªè¯„è®ºçš„äººå§ï¼ðŸŽ‰"
            : "Be the first to comment! ðŸŽ‰",
        submit: savedLang === "zh" ? "æäº¤" : "Submit",
        like: savedLang === "zh" ? "å–œæ¬¢" : "Like",
        reply: savedLang === "zh" ? "å›žå¤" : "Reply",
        cancelReply: savedLang === "zh" ? "å–æ¶ˆå›žå¤" : "Cancel Reply",
        comment: savedLang === "zh" ? "è¯„è®º" : "Comment",
        refresh: savedLang === "zh" ? "åˆ·æ–°" : "Refresh",
        more: savedLang === "zh" ? "åŠ è½½æ›´å¤š..." : "Load More...",
        preview: savedLang === "zh" ? "é¢„è§ˆ" : "Preview",
        emoji: savedLang === "zh" ? "è¡¨æƒ…" : "Emoji",
        uploadImage: savedLang === "zh" ? "ä¸Šä¼ å›¾ç‰‡" : "Upload Image",
        seconds: savedLang === "zh" ? "ç§’å‰" : "seconds ago",
        minutes: savedLang === "zh" ? "åˆ†é’Ÿå‰" : "minutes ago",
        hours: savedLang === "zh" ? "å°æ—¶å‰" : "hours ago",
        days: savedLang === "zh" ? "å¤©å‰" : "days ago",
        now: savedLang === "zh" ? "åˆšåˆš" : "just now",
      },
      emoji: [
        "//unpkg.com/@waline/emojis@1.2.0/weibo",
        "//unpkg.com/@waline/emojis@1.2.0/alus",
        "//unpkg.com/@waline/emojis@1.2.0/bilibili",
        "//unpkg.com/@waline/emojis@1.2.0/qq",
        "//unpkg.com/@waline/emojis@1.2.0/tieba",
      ],
      search: true, // Enable GIF search (requires GIPHY_API_KEY in Vercel)
      pageview: false,
      comment: true,
      dark: "auto",
      meta: ["nick", "mail", "link"],
      requiredMeta: ["nick"],
      imageUploader: true, // Enable image/GIF upload
      login: "disable", // Allow anonymous comments
    });

    return walineInstance;
  }

  // Initialize on page load
  let walineInstance: any = null;
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", () => {
      walineInstance = initWaline();
    });
  } else {
    walineInstance = initWaline();
  }

  // Listen for language changes and reinitialize Waline
  window.addEventListener("languageChange", () => {
    const container = document.getElementById("waline-container");
    if (container && walineInstance) {
      // Destroy old instance
      if (walineInstance.destroy) {
        walineInstance.destroy();
      }

      // Clear container
      container.innerHTML = "";

      // Reinitialize with new language
      setTimeout(() => {
        walineInstance = initWaline();
      }, 100);
    }
  });
</script>

<style>
  /* Custom Waline styling */
  #waline-container {
    min-height: 300px;
  }

  /* Match website theme */
  :global(.wl-panel) {
    background-color: #f9fafb !important;
    border-radius: 0.5rem !important;
  }

  :global(.wl-editor) {
    border-radius: 0.5rem !important;
  }

  :global(.wl-btn) {
    border-radius: 0.375rem !important;
  }

  :global(.wl-avatar) {
    border-radius: 0.5rem !important;
  }

  /* Image upload preview */
  :global(.wl-content img) {
    border-radius: 0.5rem;
    max-width: 100%;
    height: auto;
    margin: 1rem 0;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    :global(.wl-panel) {
      padding: 0.75rem !important;
    }
  }
</style>
